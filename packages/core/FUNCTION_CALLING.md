# GLMå‡½æ•°è°ƒç”¨åŠŸèƒ½è¯´æ˜

## æ¦‚è¿°

GLM ContentGenerator ç°åœ¨æ”¯æŒå®Œæ•´çš„å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰åŠŸèƒ½ï¼Œå…è®¸AIæ¨¡å‹å®é™…æ‰§è¡Œå·¥å…·æ“ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯è¿”å›æ–‡æœ¬å»ºè®®ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸ› ï¸ è¯·æ±‚ç«¯ - å·¥å…·å£°æ˜
- è‡ªåŠ¨è½¬æ¢ `request.config.tools` åˆ° GLM API æ ¼å¼
- å¢å¼ºå·¥å…·æè¿°ï¼Œæ˜ç¡®å‘ŠçŸ¥æ¨¡å‹è¿™äº›æ˜¯å¯æ‰§è¡Œå·¥å…·
- æ”¯æŒå®Œæ•´çš„å·¥å…·å‚æ•°éªŒè¯å’Œç±»å‹å®šä¹‰

### ğŸ¯ å“åº”ç«¯ - å·¥å…·æ‰§è¡Œ
- è‡ªåŠ¨è¯†åˆ«å¹¶è§£æ GLM è¿”å›çš„å‡½æ•°è°ƒç”¨æŒ‡ä»¤
- å®é™…æ‰§è¡Œå·¥å…·å‡½æ•°å¹¶è¿”å›ç»“æœ
- æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥å·¥å…·æ‰§è¡Œ
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç»“æœåé¦ˆ

### ğŸ”„ æµå¼æ”¯æŒ
- æµå¼æ¨¡å¼ä¸‹çš„å·¥å…·è°ƒç”¨ç´¯ç§¯å’Œæ‰§è¡Œ
- å®æ—¶å·¥å…·è°ƒç”¨çŠ¶æ€åé¦ˆ
- æµå¼å’Œéæµå¼æ¨¡å¼çš„ç»Ÿä¸€æ¥å£

### ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶
- å‡½æ•°åå®‰å…¨éªŒè¯ï¼ˆå­—ç¬¦é™åˆ¶ã€é•¿åº¦æ£€æŸ¥ï¼‰
- å‚æ•°æ·±åº¦å’Œå¤§å°é™åˆ¶
- æ‰§è¡Œè¶…æ—¶æ§åˆ¶ï¼ˆ30ç§’ï¼‰
- å±é™©å±æ€§è¿‡æ»¤
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

## ä½¿ç”¨æ–¹æ³•

### 1. åˆ›å»ºå·¥å…·æ‰§è¡Œå™¨

```typescript
const toolExecutors = {
  write_file: async ({ filename, content }: { filename: string; content: string }) => {
    // å®é™…çš„æ–‡ä»¶å†™å…¥é€»è¾‘
    await fs.writeFile(filename, content, 'utf8');
    return { success: true, message: `æ–‡ä»¶ ${filename} å†™å…¥æˆåŠŸ` };
  },
  
  get_time: async () => {
    return { timestamp: new Date().toISOString() };
  }
};
```

### 2. å®šä¹‰å·¥å…·å£°æ˜

```typescript
const tools: Tool[] = [
  {
    functionDeclarations: [
      {
        name: 'write_file',
        description: 'å†™å…¥å†…å®¹åˆ°æŒ‡å®šæ–‡ä»¶',
        parameters: {
          type: 'object',
          properties: {
            filename: { type: 'string', description: 'æ–‡ä»¶å' },
            content: { type: 'string', description: 'æ–‡ä»¶å†…å®¹' }
          },
          required: ['filename', 'content']
        }
      }
    ]
  }
];
```

### 3. åˆå§‹åŒ–ç”Ÿæˆå™¨

```typescript
// ä¼ å…¥å·¥å…·æ‰§è¡Œå™¨
const generator = new GlmContentGenerator(toolExecutors);
```

### 4. å‘èµ·å¸¦å·¥å…·çš„è¯·æ±‚

```typescript
const response = await generator.generateContent({
  contents: [{
    role: 'user',
    parts: [{ text: 'è¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ªhello.txtæ–‡ä»¶ï¼Œå†…å®¹æ˜¯"Hello World"' }]
  }],
  config: {
    tools: tools,  // ä¼ å…¥å·¥å…·å®šä¹‰
    temperature: 0.1
  }
}, 'user-prompt-id');

// response.functionCalls åŒ…å«æ‰§è¡Œçš„å·¥å…·è°ƒç”¨
// response.text åŒ…å«AIçš„æœ€ç»ˆå›ç­”
```

### 5. æµå¼å¤„ç†

```typescript
const streamGenerator = generator.generateContentStream({
  contents: [{ role: 'user', parts: [{ text: 'è·å–å½“å‰æ—¶é—´' }] }],
  config: { tools: tools }
}, 'stream-id');

for await (const chunk of streamGenerator) {
  if (chunk.text) {
    console.log('æ–‡æœ¬:', chunk.text);
  }
  if (chunk.functionCalls) {
    console.log('å·¥å…·è°ƒç”¨:', chunk.functionCalls.length);
  }
}
```

## å·¥ä½œæµç¨‹

### æ ‡å‡†æ¨¡å¼æµç¨‹
1. **è¯·æ±‚å‘é€**ï¼šå°†å·¥å…·å®šä¹‰è½¬æ¢ä¸º GLM æ ¼å¼å¹¶å‘é€
2. **AI å†³ç­–**ï¼šGLM æ¨¡å‹å†³å®šæ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
3. **å·¥å…·æ‰§è¡Œ**ï¼šè‡ªåŠ¨æ‰§è¡Œ AI æŒ‡å®šçš„å·¥å…·è°ƒç”¨
4. **ç»“æœè¿”å›**ï¼šåŒ…å«å·¥å…·æ‰§è¡Œç»“æœçš„å®Œæ•´å“åº”

### æµå¼æ¨¡å¼æµç¨‹
1. **æµå¼å“åº”**ï¼šæ¥æ”¶ GLM çš„æµå¼è¾“å‡º
2. **å·¥å…·ç´¯ç§¯**ï¼šç´¯ç§¯å®Œæ•´çš„å·¥å…·è°ƒç”¨æ•°æ®
3. **æ‰¹é‡æ‰§è¡Œ**ï¼šæµç»“æŸåæ‰¹é‡æ‰§è¡Œæ‰€æœ‰å·¥å…·
4. **ç»“æœè¾“å‡º**ï¼šè¾“å‡ºåŒ…å«æ‰§è¡Œç»“æœçš„æœ€ç»ˆå“åº”

## å®‰å…¨ç‰¹æ€§

### å‡½æ•°åéªŒè¯
- åªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- é•¿åº¦é™åˆ¶ï¼ˆæœ€å¤§100å­—ç¬¦ï¼‰
- ç¦æ­¢ç©ºæˆ–æ— æ•ˆå‡½æ•°å

### å‚æ•°å®‰å…¨
- å‚æ•°ç±»å‹æ£€æŸ¥ï¼ˆå¿…é¡»ä¸ºå¯¹è±¡ï¼‰
- åµŒå¥—æ·±åº¦é™åˆ¶ï¼ˆæœ€å¤§10å±‚ï¼‰
- å‚æ•°å¤§å°é™åˆ¶ï¼ˆæœ€å¤§1MBï¼‰
- å±é™©å±æ€§è¿‡æ»¤ï¼ˆ`__proto__`, `constructor`, `prototype`ï¼‰

### æ‰§è¡Œæ§åˆ¶
- 30ç§’æ‰§è¡Œè¶…æ—¶
- è¯¦ç»†é”™è¯¯è®°å½•
- å¼‚å¸¸å®‰å…¨å¤„ç†

## é”™è¯¯å¤„ç†

æ‰€æœ‰å·¥å…·æ‰§è¡Œéƒ½ä¼šè¿”å›æ ‡å‡†åŒ–çš„ç»“æœæ ¼å¼ï¼š

```typescript
type ToolExecutionResult = {
  success: boolean;
  result?: any;      // æˆåŠŸæ—¶çš„ç»“æœ
  error?: string;    // å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯
};
```

## æ—¥å¿—è¾“å‡º

ç³»ç»Ÿä¼šè¾“å‡ºè¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ï¼š

```
ğŸ§  Zhipu AI GLM ContentGenerator: Initialized successfully
   Available Tools: 2 functions
   - write_file, get_time

ğŸ”§ GLMå·¥å…·è½¬æ¢å®Œæˆ: å·²å‡†å¤‡ 2 ä¸ªå¯æ‰§è¡Œå·¥å…·
   - write_file: å†™å…¥å†…å®¹åˆ°æŒ‡å®šæ–‡ä»¶ [å¯æ‰§è¡Œå·¥å…· - æˆ‘ä¼šå®é™…è°ƒç”¨æ­¤åŠŸèƒ½]

ğŸ”§ GLMè¿”å›äº† 1 ä¸ªå·¥å…·è°ƒç”¨
ğŸ“‹ å·¥å…·è°ƒç”¨: write_file { filename: "hello.txt", content: "Hello World" }

ğŸš€ å¼€å§‹æ‰§è¡Œå·¥å…·è°ƒç”¨...
ğŸ”§ æ‰§è¡Œå·¥å…·è°ƒç”¨: write_file { filename: "hello.txt", content: "Hello World" }
âœ… å·¥å…· "write_file" æ‰§è¡ŒæˆåŠŸ: { success: true, message: "æ–‡ä»¶ hello.txt å†™å…¥æˆåŠŸ" }
âœ… å·¥å…·æ‰§è¡Œå®Œæˆ
```

## ç¤ºä¾‹ä»£ç 

æŸ¥çœ‹ `src/examples/glm-function-calling-example.ts` è·å–å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ã€‚

## æ³¨æ„äº‹é¡¹

1. **å·¥å…·æ‰§è¡Œå™¨å¿…é¡»åœ¨æ„é€ æ—¶æä¾›**ï¼š`new GlmContentGenerator(toolExecutors)`
2. **å·¥å…·å®šä¹‰å¿…é¡»åœ¨é…ç½®ä¸­ä¼ é€’**ï¼š`config: { tools: tools }`
3. **æ‰€æœ‰å·¥å…·æ‰§è¡Œéƒ½æ˜¯å¼‚æ­¥çš„**ï¼Œå³ä½¿å·¥å…·æœ¬èº«æ˜¯åŒæ­¥çš„
4. **é”™è¯¯ä¸ä¼šä¸­æ–­æµç¨‹**ï¼Œè€Œæ˜¯ä½œä¸ºç»“æœçš„ä¸€éƒ¨åˆ†è¿”å›
5. **æµå¼æ¨¡å¼ä¸‹å·¥å…·è°ƒç”¨åœ¨æµç»“æŸåæ‰§è¡Œ**ï¼Œä¸æ˜¯å®æ—¶çš„

## å…¼å®¹æ€§

- å®Œå…¨å‘åå…¼å®¹ï¼Œä¸å½±å“ç°æœ‰çš„éå·¥å…·è°ƒç”¨ç”¨æ³•
- æ”¯æŒ GLM-4 åŠæ›´é«˜ç‰ˆæœ¬çš„æ‰€æœ‰æ¨¡å‹
- å…¼å®¹åŸæœ‰çš„ Google GenAI æ¥å£è§„èŒƒ


